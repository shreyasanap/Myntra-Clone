<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Try-On</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap");
      *,
      *::before,
      *::after {
        padding: 0;
        margin: 0;
      }

      body {
        font-family: "Source Sans 3", Tahoma, Geneva, Verdana, sans-serif;
        padding: 1rem;
      }
      .main {
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        border: 1px solid gray;
        border-radius: 0.5rem;

        /* constrain the width and center the container */
        width: 60vw;
        margin-left: auto;
        margin-right: auto;
      }

      h1 {
        padding-bottom: 2rem;
      }

      form {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }

      form .form-field {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      form .form-field .label-text {
        font-weight: 500;
      }

      form .form-field .label-text .required-marker {
        color: tomato;
      }

      input,
      select {
        height: 2rem;
        padding: 0.25rem 0.5rem;
      }

      form button {
        height: 2rem;
        border: none;
        outline: none;
        background-color: black;
        text-transform: uppercase;
        color: white;
        font-weight: 500;
        border-radius: 2px;
        cursor: pointer;
      }

      #resultContainer img {
        max-width: 100%;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <main class="main">
      <h1>Try-On</h1>

      <form id="tryOnForm">
        <!-- User Image -->
        <label class="form-field">
          <span class="label-text">
            User Image
            <span class="required-marker">*</span>
          </span>
          <input name="userImage" type="file" required />
        </label>

        <!-- Cloth Image -->
        <label class="form-field">
          <span class="label-text">
            Cloth Image
            <span class="required-marker">*</span>
          </span>
          <input name="clothImage" type="file" required />
        </label>

        <!-- Category -->
        <label class="form-field">
          <span class="label-text">
            Category
            <span class="required-marker">*</span>
          </span>
          <select name="category">
            <option value="1">Upper Body</option>
            <option value="2">Lower Body</option>
            <option value="3">Dresses</option>
            <option value="4">Full Body</option>
            <option value="5">Hair</option>
          </select>
        </label>

        <!-- Caption (Optional) -->
        <label class="form-field">
          <span class="label-text">Caption</span>
          <input
            name="caption"
            type="text"
            placeholder="Describe the cloth (optional)"
          />
        </label>

        <button>Try On Now</button>
      </form>
      <div id="resultContainer"></div>
    </main>

    <script defer>
      // CONSTANTS
      const BACKEND_BASE_URL = "http://127.0.0.1:5000";
      const tryOnForm = document.querySelector("#tryOnForm");

      async function handleSubmit(event) {
        event.preventDefault();

        try {
          const formData = new FormData(tryOnForm);
          const response = await fetch(`${BACKEND_BASE_URL}/try-on`, {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const result = await response.json();
          console.log(result);
          const resultContainer = document.querySelector("#resultContainer");
          resultContainer.innerHTML = `<img src="${result.result}" alt="Try-On Result" />`;
        } catch (error) {
          console.error("Error:", error);
          // Handle error display if needed
        }
      }

      tryOnForm.addEventListener("submit", handleSubmit);
    </script>
  </body>
</html>
